---
import Layout from "../layouts/Layout.astro";
import ClickableLink from "../components/ClickableLink.astro";
import ToolboxItem from "../components/ToolboxItem";
import WritingItem from "../components/WritingItem.astro";

interface BlogPost {
  url: string;
  title: string;
  subtitle: string;
  coverImage: {
    url: string;
  };
  readTimeInMinutes: number;
  views: number;
}

interface BlogPostResponse {
  publication: {
    posts: {
      edges: {
        node: BlogPost;
      }[];
    };
  };
}

const response = await fetch("https://gql.hashnode.com", {
  method: "POST",
  headers: {
    "Content-Type": "application/json",
  },
  body: JSON.stringify({
    query: `
      query {
        publication(host: "indentasi.dhsrlab.com") {
          posts(first: 5) {
            edges {
              node {
                url
                title
                subtitle
                coverImage {
                  url
                }
                readTimeInMinutes
                views
              }
            }
          }
        }
      }`,
  }),
});

const postsResponse: { data: BlogPostResponse } = await response.json();

const posts = postsResponse.data.publication.posts.edges.map(
  (edge) => edge.node
);

type Tool = {
  image: string;
  name: string;
  url?: string;
  inProgress?: boolean;
  main?: boolean;
};

const tools: Tool[][] = [
  [
    { image: "/typescript.svg", name: "TypeScript", main: true },
    { image: "/rust.svg", name: "Rust" },
    { image: "/go.svg", name: "Go", main: true },
    { image: "/php.svg", name: "PHP" },
  ],
  [
    { image: "/nodejs.svg", name: "Node.js" },
    { image: "/react.svg", name: "React", main: true },
    { image: "/react.svg", name: "React Native" },
  ],
  [
    { image: "/postgresql.svg", name: "PostgreSQL" },
    { image: "/mysql.svg", name: "MySQL", main: true },
  ],
  [
    { image: "/docker.svg", name: "Docker", main: true },
    { image: "/k8s.svg", name: "Kubernetes", inProgress: true },
    { image: "/aws.svg", name: "AWS" },
  ],
];
---

<Layout title="Danil Hendra Suryawan">
  <main>
    <section class="h-screen w-screen relative">
      <div
        class="absolute top-1/2 lg:left-16 xl:left-32 -translate-y-1/2 leading-7 px-10"
      >
        <h1 class="text-5xl font-bold">Danil Hendra Suryawan</h1>
        <p class="font-light my-2">
          Full-stack engineer at
          <ClickableLink link="https://selarastech.com">
            Selarastech
          </ClickableLink>
        </p>

        <p class="font-light my-5 text-[#425466]">
          I work with end-to-end web technologies and stuff. Creating and
          <br />
          solving problems using React, TypeScript, Go, and MySQL.
        </p>

        <p class="font-light text-[#425466] mb-2">
          View my
          <ClickableLink
            link="https://docs.google.com/document/d/1zmPBRiLGmQnJuW0bGpEuAWashMNqsvDHWClJsosU4dw/edit"
          >
            resume,
          </ClickableLink>
          <ClickableLink link="mailto:hello@dhsrlab.com">
            email me,
          </ClickableLink> or find me online:
        </p>
        <div class="flex gap-1">
          <a
            target="_blank"
            href="https://github.com/danilhendrasr"
            class="inline-block hover:bg-slate-200 w-fit transition-colors duration-300 p-2 rounded-md"
          >
            <img src="/github.svg" class="w-5" />
          </a>
          <a
            target="_blank"
            href="https://linkedin.com/in/danilhendrasr"
            class="inline-block hover:bg-slate-200 w-fit transition-colors duration-300 p-2 rounded-md"
          >
            <img src="/linkedin.svg" class="w-5" />
          </a>
          <a
            target="_blank"
            href="https://twitter.com/danilhendrasr"
            class="inline-block hover:bg-slate-200 w-fit transition-colors duration-300 p-2 rounded-md"
          >
            <img src="/x.svg" class="w-5" />
          </a>
          <a
            target="_blank"
            href="https://leetcode.com/danilhendrasr"
            class="inline-block hover:bg-slate-200 w-fit transition-colors duration-300 p-2 rounded-md"
          >
            <img src="/leetcode.svg" class="w-5" />
          </a>
        </div>
      </div>

      <div
        class="hidden lg:block absolute md:top-1/2 lg:right-24 xl:right-60 md:-translate-y-1/2 h-fit"
      >
        <figure class="flex items-center flex-col">
          <img src="/bw-portrait.webp" class="lg:w-[300px] xl:w-[350px]" />
          <figcaption class="font-extralight my-2 text-xs">
            Pardon the weird mix of outer clothes :p
          </figcaption>
        </figure>
      </div>

      <div
        class="absolute left-1/2 -translate-x-1/2 bottom-5 flex items-center flex-col group cursor-pointer"
        id="hero-bottom-arrow"
      >
        <span
          class="text-[#425466] text-xs md:text-sm mb-2 group-hover:mb-2 group-hover:opacity-100 md:opacity-0 transition-all duration-300"
        >
          See more
        </span>
        <img
          src="/bottom-arrow.svg"
          class="w-6 md:w-7 transition-all origin-bottom rotate-2 animate-bounce opacity-60 group-hover:opacity-100 duration-300"
        />
      </div>
    </section>

    <section>
      <div class="flex flex-col items-center w-full">
        <h2 id="about" class="text-3xl font-bold my-10">Toolbox</h2>

        <ul class="flex flex-col gap-3">
          {
            tools.map((row) => {
              return (
                <div class="flex justify-center flex-wrap gap-2 md:gap-3">
                  {row.map((item) => {
                    return (
                      <li>
                        <ToolboxItem
                          client:load
                          image={item.image}
                          name={item.name}
                          url="https://dhsrlab.com"
                          inProgress={item.inProgress}
                          main={item.main}
                        />
                      </li>
                    );
                  })}
                </div>
              );
            })
          }
        </ul>
      </div>
    </section>

    <!-- TODO: move this section above the toolbox -->
    <section
      class="relative flex flex-col justify-center items-center my-20 px-5"
    >
      <h2 id="about" class="text-3xl font-bold my-10">Latest Writings</h2>

      <div class="max-w-[720px] flex flex-col">
        <ul class="flex flex-col gap-3">
          {
            posts.map((post) => {
              return (
                <WritingItem
                  coverUrl={post.coverImage.url}
                  url={post.url}
                  title={post.title}
                  subtitle={post.subtitle}
                  readTimeInMinutes={post.readTimeInMinutes}
                  views={post.views}
                />
              );
            })
          }
        </ul>

        <a
          href="https://indentasi.dhsrlab.com"
          class="text-sm w-full md:w-1/3 py-3 px-10 mt-10 mx-auto backdrop-blur-lg rounded-lg text-center border border-[#ddddda] hover:border-slate-500 hover:shadow-md transition-all duration-300 cursor-alias"
        >
          View all writings &rarr;
        </a>
      </div>
    </section>
  </main>
</Layout>

<script>
  const heroBottomArrow = document.getElementById("hero-bottom-arrow");
  heroBottomArrow?.addEventListener("click", () => {
    window.scrollTo({
      behavior: "smooth",
      top:
        document.getElementById("about")!.getBoundingClientRect().top +
        window.scrollY -
        100,
    });
  });
</script>
